{% extends 'base.html' %}
{% load static %}

{% block title %}Choose Payment Method{% endblock %}

{% block content %}
<style>
    .payment-card {
        max-width: 600px;
        margin: 2rem auto;
        padding: 2rem;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        background: white;
    }
    
    .payment-method {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .payment-method:hover {
        border-color: #6e8efb;
        background-color: #f8f9fa;
    }
    
    .payment-method.selected {
        border-color: #6e8efb;
        background-color: rgba(110, 142, 251, 0.05);
    }
    
    .payment-icon {
        font-size: 2rem;
        margin-right: 1rem;
        color: #6e8efb;
    }
    
    .btn-proceed {
        background-color: #6e8efb;
        border: none;
        padding: 12px;
        font-weight: 500;
        border-radius: 8px;
        transition: all 0.3s;
        width: 100%;
    }
    
    .btn-proceed:hover {
        background-color: #5a7df4;
        transform: translateY(-2px);
    }
    
    .booking-summary {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
    }
</style>

<div class="container py-5">
    <div class="payment-card">
        <h2 class="mb-4 text-center">Select Payment Method</h2>
        
        <!-- Booking Summary -->
        <div class="booking-summary">
            <h5 class="mb-3">Booking Summary</h5>
            <div class="d-flex justify-content-between">
                <div>
                    <p class="mb-1"><strong>{{ booking.event.title }}</strong></p>
                    <p class="mb-1"><i class="bi bi-calendar-event text-primary"></i> {{ booking.event.date|date:"l, F d, Y" }}</p>
                    <p class="mb-1"><i class="bi bi-clock text-primary"></i> {{ booking.event.time|time:"g:i A" }}</p>
                    <p><i class="bi bi-ticket-perforated text-primary"></i> {{ booking.quantity }} Ticket(s)</p>
                </div>
                <div class="text-end">
                    <p class="mb-1">Total Amount:</p>
                    <h4>Rs. {{ booking.total_price }}</h4>
                </div>
            </div>
        </div>

        <form method="post" action="{% url 'payments:process_payment' %}">
            {% csrf_token %}
            <input type="hidden" name="booking_id" value="{{ booking.id }}">
            
            <h5 class="mb-3">Available Payment Methods</h5>
            
            <!-- Credit Card Option -->
            <div class="payment-method" onclick="selectPayment('credit_card')">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" 
                           id="credit_card" value="credit_card" required>
                    <label class="form-check-label d-flex align-items-center" for="credit_card">
                        <i class="bi bi-credit-card payment-icon"></i>
                        <div>
                            <h6 class="mb-1">Credit/Debit Card</h6>
                            <p class="small text-muted mb-0">Visa, Mastercard, American Express</p>
                        </div>
                    </label>
                </div>
            </div>
            
            <!-- PayPal Option -->
            <div class="payment-method" onclick="selectPayment('paypal')">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" 
                           id="paypal" value="paypal">
                    <label class="form-check-label d-flex align-items-center" for="paypal">
                        <i class="fab fa-paypal payment-icon" style="color: #003087;"></i>
                        <div>
                            <h6 class="mb-1">PayPal</h6>
                            <p class="small text-muted mb-0">Pay with your PayPal account</p>
                        </div>
                    </label>
                </div>
            </div>
            
            <!-- Bank Transfer Option -->
            <div class="payment-method" onclick="selectPayment('bank_transfer')">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="payment_method" 
                           id="bank_transfer" value="bank_transfer">
                    <label class="form-check-label d-flex align-items-center" for="bank_transfer">
                        <i class="bi bi-bank payment-icon"></i>
                        <div>
                            <h6 class="mb-1">Bank Transfer</h6>
                            <p class="small text-muted mb-0">Direct transfer to our bank account</p>
                        </div>
                    </label>
                </div>
            </div>
            
            <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-proceed" id="submitBtn" disabled>
                    Proceed to Payment
                </button>
                <a href="{% url 'booking_detail' booking.id %}" class="btn btn-outline-secondary">
                    Back to Booking
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    function selectPayment(method) {
        // Update visual selection
        document.querySelectorAll('.payment-method').forEach(el => {
            el.classList.remove('selected');
        });
        event.currentTarget.classList.add('selected');
        
        // Update radio button
        document.getElementById(method).checked = true;
        
        // Enable submit button
        document.getElementById('submitBtn').disabled = false;
    }
</script>

<!-- Add to your base.html if not already present -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}